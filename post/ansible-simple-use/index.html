<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.55.5" />

  <title>Ansible å­¦ä¹ ä¹‹ç®€å•å…¥é—¨ &middot; xdhuxc</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://xdhuxc.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://xdhuxc.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://xdhuxc.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://xdhuxc.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://xdhuxc.github.io/">xdhuxc</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://xdhuxc.github.io/"><i class='fa fa-home fa-fw'></i>ä¸»é¡µ</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://xdhuxc.github.io/post/"><i class='fa fa-list fa-fw'></i>åšå®¢</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://xdhuxc.github.io/about/"><i class='fa fa-user fa-fw'></i>å…³äº</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://xdhuxc.github.io/contact/"><i class='fa fa-phone fa-fw'></i>è”ç³»ä½œè€…</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/xdhuxc" rel="me" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://www.jianshu.com/u/25ff12787f63" rel="me" target="_blank"><i class="fa fa-joomla fa-fw"></i>ç®€ä¹¦</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/***" rel="me" target="_blank"><i class="fa fa-weixin fa-fw"></i>å¾®ä¿¡</a>
    </li>
    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2019. xdhuxc ç‰ˆæƒæ‰€æœ‰ã€‚</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>

<div id="main">


<div class="header">
  <h1>Ansible å­¦ä¹ ä¹‹ç®€å•å…¥é—¨</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2018-05-14</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://xdhuxc.github.io/tags/ansible">ansible</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://xdhuxc.github.io/tags/devops">DevOps</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://xdhuxc.github.io/tags/it">IT</a>
    
  </div>
  
  

</div>


  

<h4 id="ansible-ç®€ä»‹">Ansible ç®€ä»‹</h4>

<p>Ansible æ˜¯ä¸€ç§é›†æˆITç³»ç»Ÿçš„é…ç½®ç®¡ç†ã€åº”ç”¨éƒ¨ç½²ã€æ‰§è¡Œç‰¹å®šä»»åŠ¡çš„è¿ç»´å·¥å…·ã€‚</p>

<p>Ansible åŸºäº Python è¯­è¨€å®ç°ï¼Œç”± Paramikoï¼ˆç”± Python å®ç°çš„é«˜è´¨é‡ OpenSSH åº“ï¼‰ å’Œ PyYAML ä¸¤ä¸ªå…³é”®æ¨¡å—æ„å»ºã€‚</p>

<h4 id="ansible-ç‰¹ç‚¹">Ansible ç‰¹ç‚¹</h4>

<ul>
<li>éƒ¨ç½²ç®€å•ï¼Œåªéœ€è¦åœ¨ä¸»æ§ç«¯éƒ¨ç½² ansible ç¯å¢ƒï¼Œè¢«æ§ç«¯æ— éœ€åšä»»ä½•æ“ä½œã€‚</li>
<li>é»˜è®¤ä½¿ç”¨ SSHï¼ˆSecure Shellï¼‰åè®®å¯¹è®¾å¤‡è¿›è¡Œç®¡ç†ã€‚</li>
<li>ä¸»ä»é›†ä¸­åŒ–ç®¡ç†ã€‚</li>
<li>é…ç½®ç®€å•ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ‰©å±•æ€§å¼ºã€‚</li>
<li>æ”¯æŒ API åŠè‡ªå®šä¹‰æ¨¡å—ï¼Œå¯é€šè¿‡ Python è½»æ¾æ‰©å±•ã€‚</li>
<li>é€šè¿‡ Playbooks æ¥å®šåˆ¶å¼ºå¤§çš„é…ç½®ï¼ŒçŠ¶æ€ç®¡ç†ã€‚</li>
<li>å¯¹äº‘è®¡ç®—å¹³å°ï¼Œå¤§æ•°æ®éƒ½æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚</li>
<li>æä¾›ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€æ“ä½œæ€§å¼ºçš„ Web ç®¡ç†ç•Œé¢å’Œ REST API æ¥å£&mdash; AWX å¹³å°ã€‚</li>
</ul>

<h4 id="ansible-ä¸-saltstack">Ansible ä¸ SaltStack</h4>

<h4 id="ç›¸åŒç‚¹">ç›¸åŒç‚¹</h4>

<p>éƒ½å…·å¤‡åŠŸèƒ½å¼ºå¤§ã€çµæ´»çš„ç³»ç»Ÿç®¡ç†ã€çŠ¶æ€é…ç½®ï¼Œéƒ½ä½¿ç”¨ YAML æ ¼å¼æ¥æè¿°é…ç½®ï¼Œä¸¤è€…éƒ½æä¾›ä¸°å¯Œçš„æ¨¡æ¿åŠ APIï¼Œå¯¹äº‘è®¡ç®—å’Œå¤§æ•°æ®éƒ½æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚</p>

<h4 id="åŒºåˆ«">åŒºåˆ«</h4>

<p>æœ€å¤§çš„åŒºåˆ«æ˜¯ Ansible æ— éœ€åœ¨è¢«ç›‘æ§ä¸»æœºéƒ¨ç½²ä»»ä½•å®¢æˆ·ç«¯ä»£ç†ï¼Œé»˜è®¤é€šè¿‡ SSH é€šé“è¿›è¡Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œæˆ–ä¸‹å‘é…ç½®ã€‚</p>

<h4 id="ansible-ä½¿ç”¨">Ansible ä½¿ç”¨</h4>

<h5 id="ansible-å®‰è£…">ansible å®‰è£…</h5>

<p>ä½¿ç”¨ YUM å®‰è£… ansible</p>

<pre><code>yum install -y ansible
</code></pre>

<h5 id="ansible-é…ç½®æ–‡ä»¶">ansible é…ç½®æ–‡ä»¶</h5>

<p>ansible çš„é…ç½®æ–‡ä»¶åœ¨ <code>/etc/ansible</code> ç›®å½•ä¸‹</p>

<pre><code>[root@xdhuxc ~]# ls /etc/ansible/
ansible.cfg  hosts  roles
</code></pre>

<p>å…¶ä¸­ï¼Œ
* ansible.cfg æ˜¯ ansible å·¥å…·çš„é…ç½®æ–‡ä»¶
* hosts ç”¨æ¥é…ç½®è¢«ç®¡ç†çš„æœºå™¨
* roles æ˜¯ä¸€ä¸ªç›®å½•ï¼Œplaybook å°†ä½¿ç”¨å®ƒã€‚</p>

<h5 id="ansible-ä½¿ç”¨-1">ansible ä½¿ç”¨</h5>

<p>ï¼ˆ1ï¼‰ansible ç®¡ç†æœºä¸è¢«ç®¡ç†æœºåšç§˜é’¥è®¤è¯</p>

<p>ä½¿ç”¨ ssh-keygen ç”Ÿæˆç§˜é’¥ï¼Œä¸€è·¯å›è½¦å³å¯ã€‚</p>

<pre><code>[root@xdhuxc ~]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:dXG3C6BeEXWB0zYCji16agbNndYwJb51Ezw3WxDRiL0 root@xdhuxc
The key's randomart image is:
+---[RSA 2048]----+
|         . **=BOo|
|        . B +O=B+|
|         B.=.+*o=|
|      o +.X.. E..|
|     . +SB .   . |
|      . +        |
|       +         |
|      o          |
|                 |
+----[SHA256]-----+
</code></pre>

<p>ï¼ˆ2ï¼‰å°†å…¬é’¥å†™å…¥è¢«ç®¡ç†æœº</p>

<pre><code>[root@xdhuxc ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub -p 22 root@192.168.91.130
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;
Usage: /usr/bin/ssh-copy-id [-h|-?|-f|-n] [-i [identity_file]] [-p port] [[-o &lt;ssh -o options&gt;] ...] [user@]hostname
	-f: force mode -- copy keys without trying to check if they are already installed
	-n: dry run    -- no keys are actually copied
	-h|-?: print this help
[root@xdhuxc ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub -p 22 root@192.168.91.130
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;
The authenticity of host '192.168.91.130 (192.168.91.130)' can't be established.
ECDSA key fingerprint is SHA256:9Nn+hqVia1ST1/u0qqZP+gVfeLAAwpYCsGgKlZT+8c4.
ECDSA key fingerprint is MD5:5d:ef:7a:42:ec:73:14:d4ğŸ‡©ğŸ‡ª38:c5:17:83:03:c7:ef.
Are you sure you want to continue connecting (yes/no)? yesï¼ˆè¾“å…¥yesï¼‰
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@192.168.91.130's password: ï¼ˆè¾“å…¥è¢«ç®¡æ§æœºå¯†ç ï¼‰

Number of key(s) added: 1

Now try logging into the machine, with:   &quot;ssh -p '22' 'root@192.168.91.130'&quot;
and check to make sure that only the key(s) you wanted were added.
</code></pre>

<p>ï¼ˆ3ï¼‰hosts æ–‡ä»¶ä¸­æ·»åŠ è¢«ç®¡æ§æœº
å‘ <code>/etc/ansible/hosts</code> æ–‡ä»¶ä¸­åŠ å…¥è¢«ç®¡æ§æœºä¿¡æ¯</p>

<pre><code>[Client]
192.168.91.130
</code></pre>

<p>ï¼ˆ4ï¼‰ æµ‹è¯• ansible</p>

<pre><code>[root@xdhuxc ~]# ansible Client -m ping  # æ“ä½œ Client ç»„ ï¼ˆall ä¸ºæ“ä½œ hosts æ–‡ä»¶ä¸­çš„æ‰€æœ‰ä¸»æœºï¼‰
192.168.91.130 | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
</code></pre>

<p>è¯´æ˜ï¼š</p>

<ul>
<li>-mï¼šæŒ‡å®šæ‰§è¡Œçš„æ¨¡å—ï¼Œä¾‹å¦‚ï¼Œ-m pingï¼ŒæŒ‡å®šæ‰§è¡Œ ping æ¨¡å—ã€‚</li>
<li>-iï¼šæŒ‡å®š hosts æ–‡ä»¶ä½ç½®ï¼Œé»˜è®¤ä¸ºï¼š/etc/ansible/hostsã€‚</li>
<li>-uï¼šæŒ‡å®š SSH è¿æ¥çš„ç”¨æˆ·åã€‚</li>
<li>-kï¼šæŒ‡å®šè¿œç¨‹ç”¨æˆ·å¯†ç ã€‚</li>
<li>-fï¼šæŒ‡å®šå¹¶å‘æ•°ã€‚</li>
<li>-sï¼šè¿æ¥ç”¨æˆ·ä¸æ˜¯ rootï¼Œä½†æ˜¯éœ€è¦ root æƒé™æ—¶ä½¿ç”¨ã€‚</li>
<li>-Kï¼šä½¿ç”¨ -s é€‰é¡¹æ—¶ï¼Œ-K æŒ‡å®šè¾“å…¥ root ç”¨æˆ·å¯†ç ã€‚</li>
</ul>


  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'xdhuxc';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://xdhuxc.github.io/post/ansible-common-model/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://xdhuxc.github.io/post/ansible-common-model/">Ansible å­¦ä¹ ä¹‹å¸¸ç”¨æ¨¡å—</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://xdhuxc.github.io/post/centos7-install-mongodb/">åœ¨ CentOS 7 ä¸Šå®‰è£… MongoDB æ•°æ®åº“</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://xdhuxc.github.io/post/centos7-install-mongodb/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



</div>

</div>
</div>
<script src="https://xdhuxc.github.io/js/ui.js"></script>
<script src="https://xdhuxc.github.io/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-139962821-1', 'auto');
    ga('send', 'pageview');
  }
</script>




<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="\/\/analytics.example.com\/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId',  2 ]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//analytics.example.com/piwik.php?idsite=2" style="border:0;" alt="" /></p></noscript>



</body>
</html>

