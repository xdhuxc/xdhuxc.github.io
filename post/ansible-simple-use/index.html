<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.55.5" />

  <title>Ansible 学习之简单入门 &middot; xdhuxc</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://xdhuxc.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://xdhuxc.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://xdhuxc.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://xdhuxc.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://xdhuxc.github.io/">xdhuxc</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://xdhuxc.github.io/"><i class='fa fa-home fa-fw'></i>主页</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://xdhuxc.github.io/post/"><i class='fa fa-list fa-fw'></i>博客</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://xdhuxc.github.io/about/"><i class='fa fa-user fa-fw'></i>关于</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://xdhuxc.github.io/contact/"><i class='fa fa-phone fa-fw'></i>联系作者</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/xdhuxc" rel="me" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://www.jianshu.com/u/25ff12787f63" rel="me" target="_blank"><i class="fa fa-joomla fa-fw"></i>简书</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/***" rel="me" target="_blank"><i class="fa fa-weixin fa-fw"></i>微信</a>
    </li>
    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2019. xdhuxc 版权所有。</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>

<div id="main">


<div class="header">
  <h1>Ansible 学习之简单入门</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2018-05-14</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://xdhuxc.github.io/tags/ansible">ansible</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://xdhuxc.github.io/tags/devops">DevOps</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://xdhuxc.github.io/tags/it">IT</a>
    
  </div>
  
  

</div>


  

<h4 id="ansible-简介">Ansible 简介</h4>

<p>Ansible 是一种集成IT系统的配置管理、应用部署、执行特定任务的运维工具。</p>

<p>Ansible 基于 Python 语言实现，由 Paramiko（由 Python 实现的高质量 OpenSSH 库） 和 PyYAML 两个关键模块构建。</p>

<h4 id="ansible-特点">Ansible 特点</h4>

<ul>
<li>部署简单，只需要在主控端部署 ansible 环境，被控端无需做任何操作。</li>
<li>默认使用 SSH（Secure Shell）协议对设备进行管理。</li>
<li>主从集中化管理。</li>
<li>配置简单，功能强大，扩展性强。</li>
<li>支持 API 及自定义模块，可通过 Python 轻松扩展。</li>
<li>通过 Playbooks 来定制强大的配置，状态管理。</li>
<li>对云计算平台，大数据都有很好的支持。</li>
<li>提供一个功能强大、操作性强的 Web 管理界面和 REST API 接口&mdash; AWX 平台。</li>
</ul>

<h4 id="ansible-与-saltstack">Ansible 与 SaltStack</h4>

<h4 id="相同点">相同点</h4>

<p>都具备功能强大、灵活的系统管理、状态配置，都使用 YAML 格式来描述配置，两者都提供丰富的模板及 API，对云计算和大数据都有很好的支持。</p>

<h4 id="区别">区别</h4>

<p>最大的区别是 Ansible 无需在被监控主机部署任何客户端代理，默认通过 SSH 通道进行远程命令执行或下发配置。</p>

<h4 id="ansible-使用">Ansible 使用</h4>

<h5 id="ansible-安装">ansible 安装</h5>

<p>使用 YUM 安装 ansible</p>

<pre><code>yum install -y ansible
</code></pre>

<h5 id="ansible-配置文件">ansible 配置文件</h5>

<p>ansible 的配置文件在 <code>/etc/ansible</code> 目录下</p>

<pre><code>[root@xdhuxc ~]# ls /etc/ansible/
ansible.cfg  hosts  roles
</code></pre>

<p>其中，
* ansible.cfg 是 ansible 工具的配置文件
* hosts 用来配置被管理的机器
* roles 是一个目录，playbook 将使用它。</p>

<h5 id="ansible-使用-1">ansible 使用</h5>

<p>（1）ansible 管理机与被管理机做秘钥认证</p>

<p>使用 ssh-keygen 生成秘钥，一路回车即可。</p>

<pre><code>[root@xdhuxc ~]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:dXG3C6BeEXWB0zYCji16agbNndYwJb51Ezw3WxDRiL0 root@xdhuxc
The key's randomart image is:
+---[RSA 2048]----+
|         . **=BOo|
|        . B +O=B+|
|         B.=.+*o=|
|      o +.X.. E..|
|     . +SB .   . |
|      . +        |
|       +         |
|      o          |
|                 |
+----[SHA256]-----+
</code></pre>

<p>（2）将公钥写入被管理机</p>

<pre><code>[root@xdhuxc ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub -p 22 root@192.168.91.130
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;
Usage: /usr/bin/ssh-copy-id [-h|-?|-f|-n] [-i [identity_file]] [-p port] [[-o &lt;ssh -o options&gt;] ...] [user@]hostname
	-f: force mode -- copy keys without trying to check if they are already installed
	-n: dry run    -- no keys are actually copied
	-h|-?: print this help
[root@xdhuxc ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub -p 22 root@192.168.91.130
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;
The authenticity of host '192.168.91.130 (192.168.91.130)' can't be established.
ECDSA key fingerprint is SHA256:9Nn+hqVia1ST1/u0qqZP+gVfeLAAwpYCsGgKlZT+8c4.
ECDSA key fingerprint is MD5:5d:ef:7a:42:ec:73:14:d4🇩🇪38:c5:17:83:03:c7:ef.
Are you sure you want to continue connecting (yes/no)? yes（输入yes）
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@192.168.91.130's password: （输入被管控机密码）

Number of key(s) added: 1

Now try logging into the machine, with:   &quot;ssh -p '22' 'root@192.168.91.130'&quot;
and check to make sure that only the key(s) you wanted were added.
</code></pre>

<p>（3）hosts 文件中添加被管控机
向 <code>/etc/ansible/hosts</code> 文件中加入被管控机信息</p>

<pre><code>[Client]
192.168.91.130
</code></pre>

<p>（4） 测试 ansible</p>

<pre><code>[root@xdhuxc ~]# ansible Client -m ping  # 操作 Client 组 （all 为操作 hosts 文件中的所有主机）
192.168.91.130 | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
</code></pre>

<p>说明：</p>

<ul>
<li>-m：指定执行的模块，例如，-m ping，指定执行 ping 模块。</li>
<li>-i：指定 hosts 文件位置，默认为：/etc/ansible/hosts。</li>
<li>-u：指定 SSH 连接的用户名。</li>
<li>-k：指定远程用户密码。</li>
<li>-f：指定并发数。</li>
<li>-s：连接用户不是 root，但是需要 root 权限时使用。</li>
<li>-K：使用 -s 选项时，-K 指定输入 root 用户密码。</li>
</ul>


  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'xdhuxc';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://xdhuxc.github.io/post/ansible-common-model/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://xdhuxc.github.io/post/ansible-common-model/">Ansible 学习之常用模块</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://xdhuxc.github.io/post/centos7-install-mongodb/">在 CentOS 7 上安装 MongoDB 数据库</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://xdhuxc.github.io/post/centos7-install-mongodb/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



</div>

</div>
</div>
<script src="https://xdhuxc.github.io/js/ui.js"></script>
<script src="https://xdhuxc.github.io/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-139962821-1', 'auto');
    ga('send', 'pageview');
  }
</script>




<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="\/\/analytics.example.com\/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId',  2 ]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//analytics.example.com/piwik.php?idsite=2" style="border:0;" alt="" /></p></noscript>



</body>
</html>

