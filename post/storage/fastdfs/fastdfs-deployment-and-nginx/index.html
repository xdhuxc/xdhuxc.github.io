<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>FastDFS 安装和 Nginx 代理的使用 - xdhuxc</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="xdhuxc" /><meta name="description" content="本篇博客详细介绍了 FastDFS 的安装和其配合 Nginx 使用的步骤。
" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.68.3 with theme even" />


<link rel="canonical" href="https://xdhuxc.github.io/post/storage/fastdfs/fastdfs-deployment-and-nginx/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="FastDFS 安装和 Nginx 代理的使用" />
<meta property="og:description" content="本篇博客详细介绍了 FastDFS 的安装和其配合 Nginx 使用的步骤。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xdhuxc.github.io/post/storage/fastdfs/fastdfs-deployment-and-nginx/" />
<meta property="article:published_time" content="2018-09-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-06-28T00:00:00+00:00" />
<meta itemprop="name" content="FastDFS 安装和 Nginx 代理的使用">
<meta itemprop="description" content="本篇博客详细介绍了 FastDFS 的安装和其配合 Nginx 使用的步骤。">
<meta itemprop="datePublished" content="2018-09-20T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-06-28T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1868">



<meta itemprop="keywords" content="FastDFS,Nginx,数据库," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="FastDFS 安装和 Nginx 代理的使用"/>
<meta name="twitter:description" content="本篇博客详细介绍了 FastDFS 的安装和其配合 Nginx 使用的步骤。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Xdhuxc</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">博客</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">目录</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Xdhuxc</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">博客</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">目录</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">FastDFS 安装和 Nginx 代理的使用</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-09-20 </span>
        <div class="post-category">
            <a href="/categories/%E6%8A%80%E6%9C%AF/"> 技术 </a>
            </div>
          <span class="more-meta"> 约 1868 字 </span>
          <span class="more-meta"> 预计阅读 4 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#环境信息">环境信息</a></li>
        <li><a href="#部署-fastdfs">部署 FastDFS</a></li>
        <li><a href="#安装并配置-nginx">安装并配置 Nginx</a></li>
        <li><a href="#参考资料">参考资料</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>本篇博客详细介绍了 FastDFS 的安装和其配合 Nginx 使用的步骤。</p>
<h3 id="环境信息">环境信息</h3>
<p>服务器信息：</p>
<table>
<thead>
<tr>
<th>ip</th>
<th>os</th>
<th>role</th>
</tr>
</thead>
<tbody>
<tr>
<td>172.20.15.73</td>
<td>Centos 7</td>
<td>tracker</td>
</tr>
<tr>
<td>172.20.15.75</td>
<td>Centos 7</td>
<td>storage</td>
</tr>
</tbody>
</table>
<p>软件相关信息：</p>
<table>
<thead>
<tr>
<th>soft</th>
<th>version</th>
</tr>
</thead>
<tbody>
<tr>
<td>fastdfs</td>
<td>5.11</td>
</tr>
<tr>
<td>libfastcommon</td>
<td>1.0.39</td>
</tr>
<tr>
<td>nginx</td>
<td>1.12.2</td>
</tr>
<tr>
<td>fastdfs-nginx-module</td>
<td>1.20</td>
</tr>
</tbody>
</table>
<h3 id="部署-fastdfs">部署 FastDFS</h3>
<p>1、拷贝安装包，并解压</p>
<p>将安装包考本到两台服务器的 <code>/usr/local/src</code>，并进入该目录，解压安装包：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cd /usr/local/src &amp;&amp; unzip fastdfs.zip -d /usr/local/src
cd /usr/local/src/fastdfs
ls | grep &#39;tar.gz&#39; | xargs -I {} tar -xzvf {} -C /usr/local/src/fastdfs
cd /usr/local/src/fastdfs/nginx/
ls | grep &#39;tar.gz&#39; | xargs -I {} tar -xzvf {} -C /usr/local/src/fastdfs/nginx
</code></pre></td></tr></table>
</div>
</div><p>2、安装相关依赖</p>
<p>分别进入两台服务器的 <code>/usr/local/src/fastdfs/fastdfs-lib</code> 目录，安装相关依赖：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">rpm -ivh --force /usr/local/src/fastdfs/fastdfs-lib/*
</code></pre></td></tr></table>
</div>
</div><p>3、安装 libfastcommon</p>
<p>通过如下命令，在两台服务器上安装 <code>libfastcommon</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cd /usr/local/src/fastdfs/libfastcommon-1.0.39/
./make.sh &amp;&amp; ./make.sh install
</code></pre></td></tr></table>
</div>
</div><p>看到如下信息，说明安装成功：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">if [ ! -e /usr/lib/libfastcommon.so ]; then ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so; fi
</code></pre></td></tr></table>
</div>
</div><p>安装完毕之后，设置软连接：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so
ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so
ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so
ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so
</code></pre></td></tr></table>
</div>
</div><p>4、安装 FastDFS</p>
<p>使用如下命令，在两台服务器上安装 fastdfs：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cd /usr/local/src/fastdfs/fastdfs-5.11
./make.sh &amp;&amp; ./make.sh install
</code></pre></td></tr></table>
</div>
</div><p>看到如下信息，则说明安装成功：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">if [ ! -f /etc/fdfs/client.conf.sample ]; then cp -f ../conf/client.conf /etc/fdfs/client.conf.sample; fi
</code></pre></td></tr></table>
</div>
</div><p>拷贝配置文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf
cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf
cp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf
</code></pre></td></tr></table>
</div>
</div><p>5、配置 tracker 服务器（172.20.15.73）</p>
<p>创建文件夹，用于存放 Tracker 服务器的相关文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">mkdir -p /data/fastdfs/tracker
</code></pre></td></tr></table>
</div>
</div><p>修改 tracker 的配置文件 <code>/etc/fdfs/tracker.conf</code>，修改如下部分：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">disabled=false
port=22122
base_path=/data/fastdfs/tracker
http.server_port=6666
</code></pre></td></tr></table>
</div>
</div><p>拷贝 tracker 的 systemd 文件至 <code>/usr/lib/systemd/system/</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cp /usr/local/src/fastdfs/conf/systemd/fdfs_trackerd.service /usr/lib/systemd/system/
</code></pre></td></tr></table>
</div>
</div><p>因为 <code>fdfs_trackerd</code> 等命令在 <code>/usr/local/bin</code> 中并没有，而是在 <code>/usr/bin</code> 路径下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">ln -s /usr/bin/fdfs_trackerd /usr/local/bin
ln -s /usr/bin/stop.sh /usr/local/bin
ln -s /usr/bin/restart.sh /usr/local/bin
</code></pre></td></tr></table>
</div>
</div><p>重启 systemd</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl daemon-reload
</code></pre></td></tr></table>
</div>
</div><p>启动 tracker：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl restart fdfs_trackerd
</code></pre></td></tr></table>
</div>
</div><p>设置开机启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl enable fdfs_trackerd
</code></pre></td></tr></table>
</div>
</div><p>6、配置 <code>storage</code> 服务器（172.20.15.75）</p>
<p>首先是创建 <code>storage</code> 服务器的文件目录，需要注意的是多建了一个目录，因为 <code>storage</code> 还需要一个文件存储路径，用于存放接收的文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">mkdir -p /data/fastdfs/storage
mkdir -p /data/fastdfs/storage_data
</code></pre></td></tr></table>
</div>
</div><p>修改 <code>storage</code> 的配置文件 <code>/etc/fdfs/storage.conf</code>，修改如下部分：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">disabled=false
group_name=group1
port=23000
base_path=/data/fastdfs/storage
store_path_count=1
store_path0=/data/fastdfs/storage_data
tracker_server=172.20.15.73:22122
http.server_port=8888
</code></pre></td></tr></table>
</div>
</div><p>拷贝 <code>tracker</code> 的 <code>systemd</code> 文件至 <code>/usr/lib/systemd/system/</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cp /usr/local/src/fastdfs/conf/systemd/fdfs_storaged.service /usr/lib/systemd/system/
</code></pre></td></tr></table>
</div>
</div><p>配置完成后同样要为 <code>storage</code> 服务器的启动脚本设置软引用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">ln -s /usr/bin/fdfs_storaged /usr/local/bin
</code></pre></td></tr></table>
</div>
</div><p>重启 <code>systemd</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl daemon-reload
</code></pre></td></tr></table>
</div>
</div><p>启动 <code>tracker</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl restart fdfs_storaged
</code></pre></td></tr></table>
</div>
</div><p>设置开机启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl enable fdfs_storaged
</code></pre></td></tr></table>
</div>
</div><p>查看 <code>storage</code> 服务器是否已经登记到 <code>tracker</code> 服务器（也可以理解为 <code>tracker</code> 与 <code>storage</code> 是否整合成功），运行以下命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">/usr/bin/fdfs_monitor /etc/fdfs/storage.conf
</code></pre></td></tr></table>
</div>
</div><p>看到 <code>tracker server is 172.20.15.73:22122</code>，tracker 服务器正常启动。</p>
<p>看到 <code>172.20.15.75 ACTIVE</code> 字样即可说明 <code>storage</code> 服务器已经成功注册到了 <code>tracker</code> 服务器。</p>
<h3 id="安装并配置-nginx">安装并配置 Nginx</h3>
<h4 id="安装配置-tracker-的-nginx">安装配置 tracker 的 nginx</h4>
<p>安装 <code>nginx</code> 依赖包，并安装 <code>nginx</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">rpm -ivh --force /usr/local/src/fastdfs/nginx/nginx-lib/*
rpm -ivh --force /usr/local/src/fastdfs/nginx/nginx-rpm/*
</code></pre></td></tr></table>
</div>
</div><p>将 <code>tracker</code> 的 <code>nginx</code> 的配置文件拷贝到 <code>/etc/nginx</code>，端口为 <code>9988</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cp -r /usr/local/src/fastdfs/conf/nginx-tracker.conf /etc/nginx/nginx.conf
</code></pre></td></tr></table>
</div>
</div><p>将 <code>/usr/local/src/fastdfs/fastdfs-5.11/conf</code> 中的 <code>http.conf</code> 和 <code>mime.types</code> 拷贝到 <code>/etc/fdfs</code> 目录下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cp -r /usr/local/src/fastdfs/fastdfs-5.11/conf/http.conf /etc/fdfs/
cp -r /usr/local/src/fastdfs/fastdfs-5.11/conf/mime.types /etc/fdfs/
</code></pre></td></tr></table>
</div>
</div><p>创建 <code>/var/lib/nginx/tmp</code> 以及日志文件夹：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">mkdir -p /var/lib/nginx/tmp /data/log/nginx
</code></pre></td></tr></table>
</div>
</div><p>拷贝 <code>nginx</code> 的 <code>systemd</code> 文件至 <code>/usr/lib/systemd/system/</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cp /usr/local/src/fastdfs/conf/systemd/nginx.service /usr/lib/systemd/system/
</code></pre></td></tr></table>
</div>
</div><p>重启 <code>systemd</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl daemon-reload
</code></pre></td></tr></table>
</div>
</div><p>启动 <code>nginx</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl start nginx
</code></pre></td></tr></table>
</div>
</div><p>设置开机启动：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl enable nginx
</code></pre></td></tr></table>
</div>
</div><h4 id="安装并配置-storage-的-nginx">安装并配置 storage 的 nginx</h4>
<p>安装 <code>nginx</code> 依赖包：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">rpm -ivh --force /usr/local/src/fastdfs/nginx/nginx-lib/*
</code></pre></td></tr></table>
</div>
</div><p>修改 <code>/usr/local/src/fastdfs/nginx/fastdfs-nginx-module-1.20/src/config</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">ngx_addon_name=ngx_http_fastdfs_module

if test -n &#34;${ngx_module_link}&#34;; then
    ngx_module_type=HTTP
    ngx_module_name=$ngx_addon_name
    ngx_module_incs=&#34;/usr/include/fastdfs /usr/include/fastcommon/&#34;
    ngx_module_libs=&#34;-lfastcommon -lfdfsclient&#34;
    ngx_module_srcs=&#34;$ngx_addon_dir/ngx_http_fastdfs_module.c&#34;
    ngx_module_deps=
    CFLAGS=&#34;$CFLAGS -D_FILE_OFFSET_BITS=64 -DFDFS_OUTPUT_CHUNK_SIZE=&#39;256*1024&#39; -DFDFS_MOD_CONF_FILENAME=&#39;\&#34;/etc/fdfs/mod_fastdfs.conf\&#34;&#39;&#34;
    . auto/module
else
    HTTP_MODULES=&#34;$HTTP_MODULES ngx_http_fastdfs_module&#34;
    NGX_ADDON_SRCS=&#34;$NGX_ADDON_SRCS $ngx_addon_dir/ngx_http_fastdfs_module.c&#34;
    CORE_INCS=&#34;$CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/&#34;
    CORE_LIBS=&#34;$CORE_LIBS -L/usr/lib -lfastcommon -lfdfsclient&#34;
    CFLAGS=&#34;$CFLAGS -D_FILE_OFFSET_BITS=64 -DFDFS_OUTPUT_CHUNK_SIZE=&#39;256*1024&#39; -DFDFS_MOD_CONF_FILENAME=&#39;\&#34;/etc/fdfs/mod_fastdfs.conf\&#34;&#39;&#34;
fi
</code></pre></td></tr></table>
</div>
</div><p>增加依赖包并安装 <code>nginx</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cd /usr/local/src/fastdfs/nginx/nginx-1.12.2

./configure --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --user=root --add-module=/usr/local/src/fastdfs/nginx/fastdfs-nginx-module-1.20/src

make &amp;&amp; make install
</code></pre></td></tr></table>
</div>
</div><p>将 <code>nginx</code> 的配置文件拷贝到 <code>/etc/nginx</code>，端口为 <code>9999</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cp -r /usr/local/src/fastdfs/conf/nginx-storage.conf /etc/nginx/nginx.conf
</code></pre></td></tr></table>
</div>
</div><p>将 <code>/usr/local/src/fastdfs/fastdfs-5.11/conf</code> 中的 <code>http.conf</code> 和 <code>mime.types</code> 拷贝到 <code>/etc/fdfs</code> 目录下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cp -r /usr/local/src/fastdfs/fastdfs-5.11/conf/http.conf /etc/fdfs/
cp -r /usr/local/src/fastdfs/fastdfs-5.11/conf/mime.types /etc/fdfs/
</code></pre></td></tr></table>
</div>
</div><p>把 <code>/usr/local/src/fastdfs/nginx/fastdfs-nginx-module-1.20/src</code> 安装目录下的 <code>mod_fastdfs.conf</code> 也拷贝到 /etc/fdfs` 目录下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cp -r /usr/local/src/fastdfs/nginx/fastdfs-nginx-module-1.20/src/mod_fastdfs.conf /etc/fdfs/
</code></pre></td></tr></table>
</div>
</div><p>修改 <code>/etc/fdfs/mod_fastdfs.conf</code> 下面的部分：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">base_path=/data/fastdfs/storage
tracker_server=172.20.15.73:22122
storage_server_port=23000
url_have_group_name = true
store_path0=/data/fastdfs/storage_data
group_count = 3

[group1]
group_name=group1
storage_server_port=23000
store_path_count=1
store_path0=/data/fastdfs/storage_data

[group2]
group_name=group2
storage_server_port=23000
store_path_count=1
store_path0=/data/fastdfs/storage_data

[group3]
group_name=group3
storage_server_port=23000
store_path_count=1
store_path0=/data/fastdfs/storage_data
</code></pre></td></tr></table>
</div>
</div><p>建立 <code>M00</code> 至存储目录的符号连接：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">ln -s /data/fastdfs/storage_data/data /data/fastdfs/storage_data/data/M00
</code></pre></td></tr></table>
</div>
</div><p>创建 <code>/var/lib/nginx/tmp</code> 以及日志文件夹：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">mkdir -p /var/lib/nginx/tmp /data/log/nginx
</code></pre></td></tr></table>
</div>
</div><p>拷贝 nginx 的 systemd 文件至 <code>/usr/lib/systemd/system/</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">cp /usr/local/src/fastdfs/conf/systemd/nginx.service /usr/lib/systemd/system/
</code></pre></td></tr></table>
</div>
</div><p>重启 systemd：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl daemon-reload
</code></pre></td></tr></table>
</div>
</div><p>启动 nginx：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl start nginx
</code></pre></td></tr></table>
</div>
</div><p>设置开机启动：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">systemctl enable nginx
</code></pre></td></tr></table>
</div>
</div><h4 id="以-172201523-作为-client-进行测试">以 172.20.15.23 作为 client 进行测试</h4>
<p>创建 <code>/data/fastdfs/client</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">mkdir -p /data/fastdfs/client
</code></pre></td></tr></table>
</div>
</div><p>修改 <code>/etc/fdfs/client.conf</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">base_path=/data/fastdfs/client
tracker_server=172.20.15.73:22122
http.tracker_server_port=6666
</code></pre></td></tr></table>
</div>
</div><p>上传文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">/usr/bin/fdfs_test /etc/fdfs/client.conf upload /usr/local/src/fastdfs/test/test.jpeg
</code></pre></td></tr></table>
</div>
</div><p>得到如下结果，说明上传成功：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">This is FastDFS client test program v5.11

Copyright (C) 2008, Happy Fish / YuQing

FastDFS may be copied only under the terms of the GNU General
Public License V3, which may be found in the FastDFS source kit.
Please visit the FastDFS Home Page http://www.csource.org/
for more detail.

[2018-09-06 20:30:37] DEBUG - base_path=/data/fastdfs/client, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0

tracker_query_storage_store_list_without_group:
	server 1. group_name=, ip_addr=172.20.15.75, port=23000

group_name=group1, ip_addr=172.20.15.75, port=23000
storage_upload_by_filename
group_name=group1, remote_filename=M00/00/00/rBQPS1uRHe2AKqfAAAC0cbebd6Q15.jpeg
source ip address: 172.20.15.75
file timestamp=2018-09-06 20:30:37
file size=46193
file crc32=3080419236
example file url: http://172.20.15.75:6666/group1/M00/00/00/rBQPS1uRHe2AKqfAAAC0cbebd6Q15.jpeg
storage_upload_slave_by_filename
group_name=group1, remote_filename=M00/00/00/rBQPS1uRHe2AKqfAAAC0cbebd6Q15_big.jpeg
source ip address: 172.20.15.75
file timestamp=2018-09-06 20:30:37
file size=46193
file crc32=3080419236
example file url: http://172.20.15.75:6666/group1/M00/00/00/rBQPS1uRHe2AKqfAAAC0cbebd6Q15_big.jpeg
</code></pre></td></tr></table>
</div>
</div><p>根据 <code>/group1/M00/00/00/rBQPS1uP4OOAGfVuAAC0cbebd6Q04_big.jpeg</code>，在浏览器上查看已经上传的图片：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">http://172.20.15.73:9988/group1/M00/00/00/rBQPS1uRHe2AKqfAAAC0cbebd6Q15_big.jpeg
</code></pre></td></tr></table>
</div>
</div><h3 id="参考资料">参考资料</h3>
<p><a href="https://blog.csdn.net/wlwlwlwl015/article/details/52619851">https://blog.csdn.net/wlwlwlwl015/article/details/52619851</a></p>
<p><a href="https://blog.csdn.net/jeikerxiao/article/details/79861850">https://blog.csdn.net/jeikerxiao/article/details/79861850</a></p>
<p><a href="https://my.oschina.net/wangmengjun/blog/1142982">https://my.oschina.net/wangmengjun/blog/1142982</a></p>
<p><a href="https://www.jianshu.com/p/e55702bdb2fe">https://www.jianshu.com/p/e55702bdb2fe</a></p>
<p><a href="https://naturalwill.github.io/2017/09/25/add-rtmp-module-to-nginx-by-yum/">https://naturalwill.github.io/2017/09/25/add-rtmp-module-to-nginx-by-yum/</a></p>
<p><a href="https://anyof.me/articles/236">https://anyof.me/articles/236</a></p>
<p><a href="http://blog.51cto.com/wangfeng7399/1711589">http://blog.51cto.com/wangfeng7399/1711589</a></p>
<p><a href="https://www.jianshu.com/p/00a5961e0bca">https://www.jianshu.com/p/00a5961e0bca</a></p>
<p><a href="https://blog.csdn.net/xuchaovip/article/details/60480557">https://blog.csdn.net/xuchaovip/article/details/60480557</a></p>
<p><a href="https://blog.csdn.net/name_is_wl/article/details/52979208">https://blog.csdn.net/name_is_wl/article/details/52979208</a></p>
<p><a href="http://www.ityouknow.com/fastdfs/2017/10/10/cluster-building-fastdfs.html">http://www.ityouknow.com/fastdfs/2017/10/10/cluster-building-fastdfs.html</a></p>
<p><a href="https://www.jianshu.com/p/a88c76caf317">https://www.jianshu.com/p/a88c76caf317</a></p>
<p><a href="https://www.cnblogs.com/tangwan/p/5425153.html">https://www.cnblogs.com/tangwan/p/5425153.html</a></p>
<p><a href="http://www.ityouknow.com/fastdfs/2017/10/10/cluster-building-fastdfs.html">http://www.ityouknow.com/fastdfs/2017/10/10/cluster-building-fastdfs.html</a></p>
<p><a href="https://blog.csdn.net/xyang81/article/details/52928230">https://blog.csdn.net/xyang81/article/details/52928230</a></p>
<p><a href="https://blog.csdn.net/u012453843/article/details/68957209">https://blog.csdn.net/u012453843/article/details/68957209</a></p>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">xdhuxc</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2018-06-28
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/fastdfs/">FastDFS</a>
          <a href="/tags/nginx/">Nginx</a>
          <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/linux/linux-vmware-static-ip/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">给 VMware 中创建的虚拟机设置静态 IP</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/storage/mysql/mysql-docker-and-original-deployment/">
            <span class="next-text nav-default">基于 docker 和原生方式部署 MySQL</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:xdhuxc@163.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/xdhuxc" class="iconfont icon-github" title="github"></a>
  <a href="https://xdhuxc.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2017 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">xdhuxc 版权所有</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-139962821-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
