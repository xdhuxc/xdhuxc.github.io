<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Golang 常见问题及解决 - xdhuxc</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="xdhuxc" /><meta name="description" content="本部分内容记录下 golang 开发时常见的一些问题及解决方法，以备后需。
" />






<meta name="generator" content="Hugo 0.68.3 with theme even" />


<link rel="canonical" href="https://xdhuxc.github.io/posts/programming/golang/golang-questions-and-solutions/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">



<meta property="og:title" content="Golang 常见问题及解决" />
<meta property="og:description" content="本部分内容记录下 golang 开发时常见的一些问题及解决方法，以备后需。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xdhuxc.github.io/posts/programming/golang/golang-questions-and-solutions/" />
<meta property="article:published_time" content="2019-08-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-08-05T00:00:00+00:00" />
<meta itemprop="name" content="Golang 常见问题及解决">
<meta itemprop="description" content="本部分内容记录下 golang 开发时常见的一些问题及解决方法，以备后需。">
<meta itemprop="datePublished" content="2019-08-05T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-08-05T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1076">



<meta itemprop="keywords" content="Golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Golang 常见问题及解决"/>
<meta name="twitter:description" content="本部分内容记录下 golang 开发时常见的一些问题及解决方法，以备后需。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">xdhuxc</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/posts/">
        <li class="mobile-menu-item">文章</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a><a href="">
        <li class="mobile-menu-item"></li>
      </a><a href="">
        <li class="mobile-menu-item"></li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">xdhuxc</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/posts/">文章</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href=""></a>
      </li><li class="menu-item">
        <a class="menu-item-link" href=""></a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
  <div class="post-content">
    <p>本部分内容记录下 golang 开发时常见的一些问题及解决方法，以备后需。</p>
<h3 id="x509-certificate-signed-by-unknown-authority">x509: certificate signed by unknown authority</h3>
<p>编写代码请求华为云 API，使用 docker 容器部署，基础镜像为 <code>geekidea/alpine-a:3.9</code>，执行 do 方法时报错如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">E0807 05:11:19.285019       1 elb_job.go:67] Get https://elb.ap-southeast-3.myhuaweicloud.com/v2.0/lbaas/loadbalancers: x509: certificate signed by unknown authority
</code></pre></td></tr></table>
</div>
</div><p>在 Dockerfile 中加入如下内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">RUN apk update \
        &amp;&amp; apk upgrade \
        &amp;&amp; apk add --no-cache \
        ca-certificates \
        &amp;&amp; update-ca-certificates 2&gt;/dev/null || true
</code></pre></td></tr></table>
</div>
</div><p>更新 <code>ca-certificates</code> 试试。</p>
<h3 id="make-build-报错">make build 报错</h3>
<p>1）使用 <code>make build</code> 进行构建时，报错如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">wanghuans-MacBook-Pro:xdhuxc-transform wanghuan$ make build
&gt;&gt; go build ...
build command-line-arguments: cannot load gitlab.xdhuxc.com/xdhuxc/xdhuxc-transform/src/apis: git ls-remote -q ssh://git@gitlab.xdhuxc.com/xdhuxc.git in /Users/wanghuan/GolandProjects/GoPath/pkg/mod/cache/vcs/32878bb63a0c857fed210744986dde9a48418788fe89eee3f24d5b73f5abcd2a: exit status 128:
        GitLab: The project you were looking for could not be found.
        fatal: Could not read from remote repository.
        
        Please make sure you have the correct access rights
        and the repository exists.
make: *** [build] Error 1
</code></pre></td></tr></table>
</div>
</div><p>解决：以前是可以正常构建的，把 go 版本升级到 1.13 后，就变成这样了，该版本有问题，回退到 1.12 即可解决问题。</p>
<p>2）使用 <code>make build</code> 进行构建时，报错如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">wanghuans-MacBook-Pro:hawkeye wanghuan$ make build
&gt;&gt; go build ...
<span class="gh"># gitlab.xdhuxc.org/SGT/DevOps/hawkeye/src/apis
</span><span class="gh"></span>src/apis/base.go:55:38: cannot use req (type <span class="ge">*&#34;gitlab.xdhuxc.com/xdhuxc/hawkeye/vendor/github.com/emicklei/go-restful&#34;.Request) as type *</span>&#34;github.com/emicklei/go-restful&#34;.Request in argument to b.auth.GetCustomValue
src/apis/router.go:54:46: cannot use baseController.auth.Auth (type func(*&#34;github.com/emicklei/go-restful&#34;.Request, <span class="ge">*&#34;github.com/emicklei/go-restful&#34;.Response, *</span>&#34;github.com/emicklei/go-restful&#34;.FilterChain)) as type &#34;gitlab.xdhuxc.com/xdhuxc/hawkeye/vendor/github.com/emicklei/go-restful&#34;.FilterFunction in argument to baseController.ws.Filter
make: *** [build] Error 2
</code></pre></td></tr></table>
</div>
</div><p>解决：删除本地项目中 <code>gitlab.xdhuxc.com/xdhuxc/hawkeye/vendor/github.com/emicklei/go-restful</code> 目录，重新编译。</p>
<h3 id="向-map-中写入键值对时报错-panicassignment-to-entry-in-nil-map">向 map 中写入键值对时，报错 <code>panic：assignment to entry in nil map</code></h3>
<p>因为该 map 的初始化方式不对，当仅写 <code>var map[keyType]ValueType</code> 时，会得到 nil map，此时向 map 中插入键值对时，会报上述错误。</p>
<p>一旦使用 make() 函数进行初始化，就不是 nil map 了。</p>
<h3 id="都是标签惹的祸">都是标签惹的祸</h3>
<p>在进行 JSON 序列化时，如果给结构体中某两个字段定义了相同的标签值，则这两个字段在序列化后的 JSON 体中都将会被去掉。</p>
<p>比如，如下的结构体：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">package main

import (
	&#34;encoding/json&#34;
	&#34;fmt&#34;
)

type User struct {
	ID string <span class="sb">`json:&#34;id&#34;`</span>
	Name string <span class="sb">`json:&#34;name&#34;`</span>
	Address string  <span class="sb">`json:&#34;address&#34;`</span>
	Password string <span class="sb">`json:&#34;name&#34;`</span>
}

func main() {
	user := User{
		ID: &#34;abc&#34;,
		Name: &#34;xdhuxc&#34;,
		Address: &#34;s&#34;,
		Password: &#34;073#asd&#34;,
	}
	dataInBytes, _ := json.Marshal(&amp;user)
	fmt.Println(string(dataInBytes))
}
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">{&#34;id&#34;:&#34;abc&#34;,&#34;address&#34;:&#34;s&#34;}
</code></pre></td></tr></table>
</div>
</div><p>将字段 Name 和 Password 的 JSON 标签设置为相同的后，两个字段在序列化后直接被去掉了。</p>
<h3 id="使用-go-mod-tidy-命令报错">使用 <code>go mod tidy</code> 命令报错</h3>
<p>使用 <code>go mod tidy</code> 命令时，报错如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">wanghuans-MacBook-Pro:confd wanghuan$ go mod tidy
go: modules disabled inside GOPATH/src by GO111MODULE=auto; see &#39;go help modules&#39;
</code></pre></td></tr></table>
</div>
</div><p>默认设置的 <code>GO111MODULE=auto</code> 导致 <code>modules</code> 默认在 <code>$GOPATH/src</code> 路径下是不启用的。如果需要在 <code>$GOPATH/src</code> 目录下也能使用 <code>modules</code>，需要把 <code>GO111MODULE</code> 环境变量设置为 <code>on</code>。</p>
<pre><code>export GO111MODULE=on
</code></pre><h3 id="使用-vscode-运行-golang-程序单元测试没有代码日志输出">使用 VSCode 运行 golang 程序单元测试，没有代码日志输出</h3>
<p>在 <code>.vscode/settings.json</code> 文件中，加入如下内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">&#34;go.testFlags&#34;: [
    &#34;-v&#34;
],
&#34;go.testTimeout&#34;: &#34;300s&#34;,  # 单元测试执行时间超过 300s，则直接结束该测试，
</code></pre></td></tr></table>
</div>
</div><h3 id="使用-git-拉取私有仓库代码时报错">使用 git 拉取私有仓库代码时，报错</h3>
<pre><code>wanghuan@wanghuans-MBP xdhuxc-cicd % make build
&gt;&gt; go build ...
go: finding module for package gitlab.xdhuxc.com/sgt/xdhuxc-common/log
go: finding module for package gitlab.xdhuxc.com/sgt/xdhuxc-common/src/models
go: finding module for package gitlab.xdhuxc.com/sgt/xdhuxc-jenkins
go: finding module for package gitlab.xdhuxc.com/sgt/xdhuxc-common/pkg
go: finding module for package gitlab.xdhuxc.com/sgt/xdhuxc-common/src/service
go: finding module for package gitlab.xdhuxc.com/sgt/xdhuxc-common/event
src/apis/base.go:9:2: module gitlab.xdhuxc.com/sgt/xdhuxc-common/event: git ls-remote -q origin in /Users/wanghuan/GolandProjects/GoPath/pkg/mod/cache/vcs/28da36e7c579b99f1d7066993405e1672802dc58e6f44b68d781fae79c0b54fb: exit status 128:
        fatal: could not read Username for 'https://gitlab.xdhuxc.com': terminal prompts disabled
Confirm the import path was entered correctly.
If this is a private repository, see https://golang.org/doc/faq#git_https for additional information.
</code></pre><p>参照 <a href="https://golang.org/doc/faq#git_https">https://golang.org/doc/faq#git_https</a> 中的方法，在 ~/.gitconfig 文件中加入如下内容：</p>
<pre><code>[url &quot;ssh://git@gitlab.xdhuxc.com/&quot;]
        insteadOf = https://gitlab.xdhuxc.com/
</code></pre><h3 id="this-download-does-not-match-the-one-reported-by-the-checksum-server">This download does NOT match the one reported by the checksum server.</h3>
<p>使用 <code>go mod tidy</code> 整理 golang 项目依赖时，控制台显示如下错误：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">wanghuan@wanghuans-MacBook-Pro scmp-common % go mod tidy
github.com/panjf2000/ants@v1.2.0: verifying module: checksum mismatch
        downloaded: h1:Ufw4aDz9RqH1RVblx2W9L9Uv5vSX5apbX5+peR7LQ5k=
        sum.golang.org: h1:pMQ1/XpSgnWx3ro4y1xr/uA3jXUsTuAaU3Dm0JjwggE=

SECURITY ERROR
This download does NOT match the one reported by the checksum server.
The bits may have been replaced on the origin server, or an attacker may
have intercepted the download attempt.

For more information, see &#39;go help module-auth&#39;.
</code></pre></td></tr></table>
</div>
</div><p>解决：先清理 mod 的缓存，然后再指定该命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-markdown" data-lang="markdown">go clean -modcache
go mod tidy
</code></pre></td></tr></table>
</div>
</div>
  </div>
</article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    %!(EXTRA string=<a class="hexo-link" href="https://gohugo.io">Hugo</a>)
  </span>
  <span class="division">|</span>
  <span class="theme-info">
     - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
     - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">xdhuxc 版权所有</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>








</body>
</html>
